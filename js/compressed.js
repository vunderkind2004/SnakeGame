var dx=20;var dy=20;var y_upper=-20;function point(a,b){this.x=a;this.y=b}function element(a,b){this.position={x:a,y:b};this.classN="element"}function life(a,b){this.position={x:a,y:b};this.ID=""}function Snake(a){this.score=0;this.savedScore=0;this.elements=[];this.elements[0]=new element(0,0);this.elements[0].ID=a+"0";this.elements[0].visible=true;this.timeStep=300;this.Name=a;this.currentMoveDirrection="down";this.newMoveDirrection="down";this.punished=[];this.punish_n=0;this.lifeCount=5;this.lifes=[];this.lifes[0]=new life(0,y_upper);this.lifes[0].ID=a+"life_0";this.alive=true}Snake.prototype.hide=function(){$(("#"+this.elements[0].ID)).hide()};Snake.prototype.show=function(){$(("#"+this.elements[0].ID)).show()};Snake.prototype.attention=function(a){var b=3;var c=500;var d=false;for(j=1;j<=b;j++){setTimeout(function(){a.hide()},(j-1)*c);setTimeout(function(){a.show()},j*c-c/2)}setTimeout(function(){a.LifeDown()},b*c)};Snake.prototype.LifePosition=function(x){var n=this.lifes.length;if(n>0){for(i=0;i<=n-1;i++){this.lifes[i].position.x=x-dx*i}}};Snake.prototype.Set_new_out=function(){if(this.out1&&(!this.out2)){this.new_out=true}else{this.new_out=false}};Snake.prototype.Reset=function(){var n=this.elements.length;for(var i=1;i<n;i++){var a="#"+this.elements[i].ID;$(a).remove()}this.elements=[];this.elements[0]=new element(0,0);this.elements[0].ID=this.Name+"0";this.elements[0].visible=true;this.currentMoveDirrection="down";this.newMoveDirrection="down";this.score=0};Snake.prototype.FullReset=function(){var n=this.elements.length;for(var i=1;i<n;i++){var a="#"+this.elements[i].ID;$(a).remove()}this.elements=[];this.elements[0]=new element(0,0);this.elements[0].ID=this.Name+"0";this.elements[0].visible=true;this.currentMoveDirrection="down";this.newMoveDirrection="down";this.score=0;this.savedScore=0;this.punished=[];this.punish_n=0;this.lifeCount=5;this.alive=true;this.ResetLife()};Snake.prototype.levelUp=function(){var n=this.elements.length;for(var i=1;i<n;i++){var a="#"+this.elements[i].ID;$(a).remove()}this.elements=[];this.elements[0]=new element(0,0);this.elements[0].ID=this.Name+"0";this.elements[0].visible=true;this.currentMoveDirrection="down";this.newMoveDirrection="down";this.savedScore=this.score};Snake.prototype.addElement=function(){var n=this.elements.length;this.elements[n]=new element(this.elements[n-1].position.x,this.elements[n-1].position.y);this.elements[n].ID=this.Name+n;this.elements[n].visible=false;var a=$(("#"+this.elements[0].ID)).clone();a.attr("id",this.elements[n].ID);a.prependTo("#end")};Snake.prototype.MoveTo=function(x,y){var n=this.elements.length;var a=new point(x,y);if(n>0){for(i=n-1;i>0;i--){this.elements[i].position.x=this.elements[i-1].position.x;this.elements[i].position.y=this.elements[i-1].position.y}this.elements[0].position.x=a.x;this.elements[0].position.y=a.y}else{console.log("'MoveTo' error: elements.length="+n)}};Snake.prototype.IsOut_i=function(a,b,c,d,i){var x=this.elements[i].position.x;var y=this.elements[i].position.y;if(((x<a)||(x>c))||((y<b)||(y>d))){return true}else{return false}};Snake.prototype.Punish=function(F,x,y){var n=this.elements.length;if(n>1){var a=F.position.x;var b=F.position.y;var c=F.width+a;var d=F.height+b;var e=this.IsOut_i(a,b,c,d,0);var f=this.IsOut_i(a,b,c,d,1);var g=this.punish_n;if(e&&!f){g++;this.punish_n=g;this.punished[g]=1;$(("#"+this.elements[0].ID)).hide();this.elements[0].visible=false}else{if((this.punished[g]<n)&&(this.punished[g]>0)){$(("#"+this.elements[this.punished[g]].ID)).hide();this.elements[this.punished[g]].visible=false;this.punished[g]++}else{if(this.punished[g]==0){if(g>0){g--;this.punish_n=g}}else{if(this.punished[g]==n){this.MoveTo(x,y)}if(this.punished[g]<2*n){$(("#"+this.elements[this.punished[g]-n].ID)).show();this.elements[this.punished[g]-n].visible=true;this.punished[g]++}else{this.punished[g]=0}}}}for(var i=n;i>0;i--){if(this.elements[i-1].visible){if(i<n){this.elements[i].visible=true}$(("#"+this.elements[i-1].ID)).show()}else{$(("#"+this.elements[i-1].ID)).hide()}}}};Snake.prototype.Move=function(){var a=new point(this.elements[0].position.x,this.elements[0].position.y);var b=this.currentMoveDirrection;switch(b){case"up":a.y-=dy;break;case"down":a.y+=dy;break;case"left":a.x-=dx;break;case"right":a.x+=dx;break;default:console.log("move error: uknow dirrection word comand");break}this.MoveTo(a.x,a.y)};Snake.prototype.UpdateMoveDirr=function(){this.currentMoveDirrection=this.newMoveDirrection;this.Move()};Snake.prototype.isContainPoint=function(x,y){var n=this.elements.length;if(n>0){for(i=0;i<n;i++){if((this.elements[i].position.x==x)&&(this.elements[i].position.y==y)){return true}}}else{console.log("'isContainPoint' error: elements.length="+n)}return false};Snake.prototype.IsEatApple=function(x,y){var a=this.elements[0].position.x;var b=this.elements[0].position.y;if(x==a&&y==b){return true}else{return false}};Snake.prototype.IsEatSelf=function(){var a=this.elements[0].position.x;var b=this.elements[0].position.y;var n=this.elements.length;if(n>0){for(i=1;i<n;i++){if((this.elements[i].position.x==a)&&(this.elements[i].position.y==b)){return true}}}else{console.log("'isContainPoint' error: elements.length="+n)}return false};Snake.prototype.Refresh=function(a,b){var n=this.elements.length;if(n>0){for(i=0;i<n;i++){var x=this.elements[i].position.x;var y=this.elements[i].position.y;$(("#"+this.elements[i].ID)).css('left',x+a);$(("#"+this.elements[i].ID)).css('top',y+b)}var c=this.lifes.length;for(j=0;j<c;j++){var x=this.lifes[j].position.x;var y=this.lifes[j].position.y;$(("#"+this.lifes[j].ID)).css('left',x+a);$(("#"+this.lifes[j].ID)).css('top',y+b)}}else{console.log("'Refresh' error: elements.length="+n)}};Snake.prototype.IsOut=function(a,b,c,d){var x=this.elements[0].position.x;var y=this.elements[0].position.y;if(((x<a)||(x>c))||((y<b)||(y>d))){return true}else{return false}};Snake.prototype.LifeUp=function(){var n=this.lifes.length;this.lifes[n]=new life(this.lifes[n-1].position.x+dx,this.lifes[n-1].position.y);this.lifes[n].ID=this.Name+"life_"+n;var a=$(("#"+this.lifes[0].ID)).clone();a.attr("id",this.lifes[n].ID);a.prependTo("#end")};Snake.prototype.ResetLife=function(){var v=this.lifes.length;for(i=1;i<v;i++){var a="#"+this.lifes[i].ID;$(a).remove()}this.lifes=[];this.lifes[0]=new life(0,y_upper);this.lifes[0].ID=this.Name+"life_0";var n=this.lifeCount;for(i=1;i<n;i++){this.LifeUp()}};Snake.prototype.LifeDown=function(){var v=this.lifes.length;if(v<=1){this.alive=false}else{var a=[];for(i=0;i<v-1;i++){a[i]=this.lifes[i]}var b=this.savedScore;this.Reset();this.score=b;this.savedScore=b;var c="#"+this.lifes[v-1].ID;$(c).remove();this.lifes=a}};Snake.prototype.LifeDownReset=function(){var a=[];a=this.lifes;var b=this.savedScore;this.Reset();this.score=b;this.savedScore=b;this.lifes=a};function field(a,r,c){this.rows=r;this.columns=c;this.position=new point(0,0);this.width=(this.columns-1)*dx;this.height=(this.rows-1)*dy;this.ID=a}function apple(a){this.x=0;this.y=0;this.ID=a}apple.prototype.Random=function(a,b){var c=dx;var d=dy;var x=Math.random()*(a-c);x=dx*Math.round(x/dx);var y=Math.random()*(b-d);y=dy*Math.round(y/dy);this.x=x;this.y=y};apple.prototype.Refresh=function(){var x=this.x;var y=this.y;$(("#"+this.ID)).css('left',x+X0);$(("#"+this.ID)).css('top',y+Y0)};function stone(a){this.enable=false;this.elements=[];this.elements[0]=new element(0,0);this.elements[0].ID=a+"0";this.elements[0].visible=true;this.Name=a}stone.prototype.addElement=function(){var n=this.elements.length;this.elements[n]=new element(this.elements[n-1].position.x,this.elements[n-1].position.y);this.elements[n].ID=this.Name+n;this.elements[n].visible=false;var a=$(("#"+this.elements[0].ID)).clone();a.attr("id",this.elements[n].ID);a.prependTo("#end")};stone.prototype.Reset=function(){var n=this.elements.length;for(var i=1;i<n;i++){var a="#"+this.elements[i].ID;$(a).remove()}this.enable=false};stone.prototype.Random=function(a,b){var c=dx;var d=dy;var n=this.elements.length;if(n>0){for(i=0;i<n;i++){var x=Math.random()*(a-2*c);x=dx*Math.round(x/dx)+dx;var y=Math.random()*(b-2*d);y=dy*Math.round(y/dy)+dy;this.elements[i].position.x=x;this.elements[i].position.y=y}}else{console.log("'stone random' error: elements.length="+n)}};stone.prototype.Refresh=function(a,b){var n=this.elements.length;if(n>0){for(i=0;i<n;i++){var x=this.elements[i].position.x;var y=this.elements[i].position.y;$(("#"+this.elements[i].ID)).css('left',x+a);$(("#"+this.elements[i].ID)).css('top',y+b)}}else{console.log("'Refresh of stone' error: elements.length="+n)}};stone.prototype.isContainPoint=function(x,y){var n=this.elements.length;if(n>0){for(i=0;i<n;i++){if((this.elements[i].position.x==x)&&(this.elements[i].position.y==y)){return true}}}else{console.log("'isContainPoint' error: elements.length="+n)}return false};stone.prototype.isMeetSnake=function(a){if(!(this.enable)){return false}var x=a.elements[0].position.x;var y=a.elements[0].position.y;var n=this.elements.length;if(n>0){for(i=0;i<n;i++){if((this.elements[i].position.x==x)&&(this.elements[i].position.y==y)){return true}}}else{console.log("'isContainPoint' error: elements.length="+n)}return false};var X0=0;var Y0=0;var timeStep=100;var minTimeStep=20;var maxTimeStep=150;var Start_speed=1;var speed=Start_speed;var minSpeed=1;var maxSpeed=20;var pauseEnable=false;var score=0;var score2=0;var rows=20;var columns=30;var FieldWidth=columns*dx;var FieldHeight=rows*dy;var ElementSpace=3;var t;var timer_is_on=0;var start=false;var isTeleportOn=true;var levelUp;var level;var levelUp_val;var snake1=new Snake("snake1_");var snake2=false;var field1=new field("field",rows,columns);var apple1=new apple("apple");var stone1=new stone("stone");stone1.enable=false;SetDefaultConfig();function SetDefaultConfig(){levelUp=0;level=1;levelUp_val=5}function onLoad(){$("#startBt").focus();$("#textBox").focus();$("body").click(function(){$("#textBox").focus()});$("body").keydown(function(a){keyDownHandler(a.keyCode);$("#textBox").val("")});initComponent(snake1,field1,apple1);if(snake2){initComponent2(snake2)}initComponentStone(stone1);initComponentLife();gameOverHide();levelUpHide();startGame()}function initComponent(a,b,c){var d="#"+a.elements[0].ID;var e="#"+c.ID;var f="#"+b.ID;$(d).innerWidth(dx);$(d).innerHeight(dy);$(d).width(dx-ElementSpace);$(d).height(dy-ElementSpace);$(e).innerWidth(dx);$(e).innerHeight(dy);$(e).width(dx-ElementSpace);$(e).height(dy-ElementSpace);$(f).width(FieldWidth+1);$(f).height(FieldHeight+1)}function initComponent2(a){var b="#"+a.elements[0].ID;$(b).innerWidth(dx);$(b).innerHeight(dy);$(b).width(dx-ElementSpace);$(b).height(dy-ElementSpace)}function initComponentStone(a){var b="#"+a.elements[0].ID;$(b).innerWidth(dx);$(b).innerHeight(dy);$(b).width(dx-ElementSpace);$(b).height(dy-ElementSpace);if(a.enable){$(b).show()}else{$(b).hide()}}function initComponentLife(){snake1.ResetLife();if(snake2){snake2.lifes[0].position.x=500;snake2.ResetLife()}}function gameOverHide(){$("#gameOver").hide()}function gameOverShow(){$("#gameOver").show();$("#startBt").focus();$("#pauseBt").attr("disabled","disabled");pauseEnable=false}function levelUpShow(a){$("#levelUp").show(a)}function levelUpHide(a){$("#levelUp").hide(a)}function startGame(){var a="#"+field1.ID;$(a).css('left',0);$(a).css('top',0);X0=$(a).position().left+1;Y0=$(a).position().top+1;snake1.MoveTo(field1.width,snake1.elements[0].position.y);snake1.LifePosition(field1.width);if(!start){for(var i=1;i<=3;i++){snake1.addElement();if(snake2){snake2.addElement()}}}snake1.Refresh(X0,Y0);if(snake2){snake2.Refresh(X0,Y0)}randomStone();stone1.Refresh(X0,Y0);randomAppleCorrect();apple1.Refresh();setTimeStep();csoreUpdate()}function randomStone(){var w=field1.width;var h=field1.height;stone1.Random(w,h)}function addStone(){stone1.addElement();randomStone();stone1.Refresh(X0,Y0)}function randomAppleCorrect(){var w=field1.width;var h=field1.height;apple1.Random(w,h);if(snake2){while(snake1.isContainPoint(apple1.x,apple1.y)||(snake2.isContainPoint(apple1.x,apple1.y)&&snake2)||(stone1.enable&&stone1.isContainPoint(apple1.x,apple1.y))){apple1.Random(w,h)}}else{while(snake1.isContainPoint(apple1.x,apple1.y)||(stone1.enable&&stone1.isContainPoint(apple1.x,apple1.y))){apple1.Random(w,h)}}}function setTimeStep(){timeStep=minTimeStep+(maxSpeed-speed)*(maxTimeStep-minTimeStep)/maxSpeed}function timedCount(){t=setTimeout("timedCount()",timeStep);cycle()}function isSnakeOut(a,F){var b=F.position.x;var c=F.position.y;var d=F.width+b;var e=F.height+c;return a.IsOut(b,c,d,e)}function teleport(a,F){var b=F.position.x;var c=F.position.y;var d=F.width+b;var e=F.height+c;var f=a.elements[0].position.x;var g=a.elements[0].position.y;switch(f){case b-dx:a.elements[0].position.x=d;break;case d+dx:a.elements[0].position.x=b;break;default:break}switch(g){case c-dy:a.elements[0].position.y=e;break;case e+dy:a.elements[0].position.y=c;break;default:break}}function PunishSnake(a,F){var b=F.position.x;var c=F.position.y;var d=F.width+b;var e=F.height+c;var f=a.elements[0].position.x;var g=a.elements[0].position.y;var x=f;var y=g;if(f<b){x=d}if(f>d){x=b}if(g<c){y=e}if(g>e){y=c}a.Punish(F,x,y)}function doTimer(){if(!timer_is_on){timer_is_on=1;timedCount()}}function stopCount(){clearTimeout(t);timer_is_on=0}function Reset(){GameOver(false);score=0;speed=Start_speed;csoreUpdate();timer_is_on=0;start=false;snake1.FullReset();if(snake2){snake2.FullReset()}initComponentLife();startGame()}function GameOver(a){stopCount();SetDefaultConfig();stone1.Reset();initComponentStone(stone1);if(a){gameOverShow()}}function keyDownHandler(a){var b=snake1.currentMoveDirrection;var c="down";if(snake2){c=snake2.currentMoveDirrection}else{c=b}var d="down";var e="down";var f=false;var g=false;if(timer_is_on==1){switch(a){case 65:if(c!="right"){d="left";g=true}break;case 37:if(b!="right"){e="left";f=true}break;case 87:if(c!="down"){d="up";g=true}break;case 38:if(b!="down"){e="up";f=true}break;case 68:if(c!="left"){d="right";g=true}break;case 39:if(b!="left"){e="right";f=true}break;case 83:if(c!="up"){d="down";g=true}break;case 40:if(b!="up"){e="down";f=true}break;default:break}}switch(a){case 13:{StartReset()}break;case 27:if(pauseEnable){pause()}break;default:break}if(f){var h=snake1;var i=h.punish_n;var j=h.punished[i];var n=h.elements.length;if((i==0)||(j>n)){h.newMoveDirrection=e}}if(g){var h=snake1;if(snake2){var h=snake2}var i=h.punish_n;var j=h.punished[i];var n=h.elements.length;if((i==0)||(j>n)){h.newMoveDirrection=d}}}function addSpeed(){if(speed!=maxSpeed){speed++;setTimeStep();$("#subSpeed").removeAttr("disabled")}else{$("#addSpeed").attr("disabled","disabled")}}function subSpeed(){if(speed!=minSpeed){speed--;setTimeStep();$("#addSpeed").removeAttr("disabled")}else{$("#subSpeed").attr("disabled","disabled")}}function csoreUpdate(){var a="Score ";if(snake2){a=a+snake2.score+" : "+snake1.score}else{a=a+snake1.score}a+="; Level "+level;$("#score").text(a)}function StartReset(){gameOverHide();if(!start){start=true;$("#startBt").attr("value","Reset");$("#pauseBt").attr("value","Pause");$("#pauseBt").removeAttr("disabled");pauseEnable=true;startGame();doTimer()}else{$("#startBt").attr("value","Start");$("#pauseBt").attr("value","Pause");$("#pauseBt").attr("disabled","disabled");pauseEnable=false;Reset()}}function pause(){if(timer_is_on==1){stopCount();$("#pauseBt").attr("value","Continue")}else{if(start){$("#pauseBt").attr("value","Pause");doTimer()}}}function levelUpDo(){stopCount();csoreUpdate();timer_is_on=0;start=false;snake1.levelUp();if(snake2){snake2.levelUp()}startGame();levelUpShow();setTimeout(function(){levelUpHide();doTimer();start=true},1000)}function lifeDownDo(){snake1.LifeDownReset();if(snake2){snake2.LifeDownReset()}timer_is_on=0;start=false;startGame();setTimeout(function(){doTimer();start=true;pauseEnable=true},1000)}function cycle(){if(cycleSn(snake1)){if(snake2){cycleSn(snake2)}}}function cycleSn(a){a.UpdateMoveDirr();if(stone1.isMeetSnake(a)){LifeDown(a);return false}if(snake2){PunishSnake(a,field1);a.Refresh(X0,Y0)}else{if(isSnakeOut(a,field1)||a.IsEatSelf()){LifeDown(a)}else{a.Refresh(X0,Y0)}}BonAppetite(a,apple1);return true}function BonAppetite(a,b){if(a.IsEatApple(b.x,b.y)){a.addElement();randomAppleCorrect();b.Refresh();a.score++;levelUp++;if(levelUp==levelUp_val){levelUp_val+=3;level++;levelUp=0;if(level%2==0){if(level==2){stone1.enable=true;initComponentStone(stone1)}else{addStone()}}else{addSpeed()}levelUpDo()}csoreUpdate()}}function LifeDown(a){stopCount();pauseEnable=false;a.attention(a);levelUp=0;setTimeout(after_wait,1500);function after_wait(){if(a.alive){lifeDownDo()}else{GameOver(true)}}}var startF="#StartField";var gameCont="#gameContainer";function OnLoadStart(){setMenuButtonHover2("SnakeStart2");$("#needJS").hide();$(gameCont).hide();setPoint();setMainMenu()}function setMainMenu(){clearBox();setStartBtns();setBtnPosition()}function setPoint(){x0=$(startF).position().left;y0=$(startF).position().top}function clearBox(){$(startF+">*").remove()}function setStartBtns(){var a='<img id="start_page" src="img/Star_Page.png" />';a+='<div class="Btn1" onclick="goToMode(1)">';a+='<img src="img/Play_game.png" /></div> ';a+='<div class="Btn2" onclick="goToMode(2)"><img src="img/How_to_play.png" /></div>';a+='<div class="Btn3" onclick="goToMode(3)"><img src="img/About_game.png" /></div>';$(startF).append(a)}function setBtnPosition(){for(var i=1;i<=3;i++){var c=".Btn"+i;var x=$(c).position().left;var y=$(c).position().top;$(c).css('left',x+x0);$(c).css('top',y+y0)}}function howToPlaySW(){}function goToMode(a){$("#start_page").remove();$(".Btn1").remove();$(".Btn2").remove();$(".Btn3").remove();var b="";var c="";var d="";var e="";var f=60;var g=360;var h=215;var i=145;var j=348;switch(a){case 1:b="<img id='start_page' src='img/Choose_Mode_1.png' />";c="<div id='goTo1'><img src='img/One_player.png'  /></div>";d="<div id='goTo2'><img src='img/Two_players.png'  /></div>";e="<div id='goToM'><img src='img/Main_page.png'  /></div>";$(startF).append(b);$(startF).append(c);$(startF).append(d);$(startF).append(e);$("#goTo1").css('left',x0+f);$("#goTo1").css('top',y0+i);$("#goTo1").click(function(){loadOneSnake()});$("#goTo2").css('left',x0+g);$("#goTo2").css('top',y0+i);$("#goTo2").click(function(){loadTwoSnakes()});$("#goToM").css('left',x0+h);$("#goToM").css('top',y0+j);$("#goToM").click(function(){setMainMenu()});break;case 2:b="<img id='start_page' src='img/How_To_Play_Main.png' />";e="<div id='goToM'><img src='img/Main_page.png'  /></div>";$(startF).append(b);$(startF).append(e);$("#goToM").css('left',x0+h);$("#goToM").css('top',y0+j);$("#goToM").click(function(){setMainMenu()});break;case 3:b="<div> Something about game .....<br/> <br/> Sorry, this part is under construction... </div>";e="<div id='goToM'><img src='img/Main_page.png'  /></div>";$(startF).append(b);$(startF).append(e);$("#goToM").css('left',x0+h);$("#goToM").css('top',y0+j);$("#goToM").click(function(){setMainMenu()});break;default:break}}function addGameField(){$(startF).hide();var a='';a+='<div id="field">';a+='<div id="gameOver"><img src="img/Game_Over.png" /></div>';a+='<div id="levelUp"><img src="img/Level_Up.png" /></div>';if(snake2){a+='<div id="snake2_0" class="element2"></div>'}a+='<div id="snake1_0" class="element"></div>';a+='<div id="stone0" class="stone"></div>';a+='<div id="snake1_life_0" class="life1"></div>';a+='<div id="snake2_life_0" class="life2"></div>';a+='<div id="end"><div id="apple"></div></div></div>';a+='<div id="controls">';a+='<input id="startBt" type="button" value="Start" onclick="StartReset()"/>';a+='<input id="pauseBt" type="button" value="Pause" disabled="disabled" onclick="pause()"/>';a+='<span id="score">Score: 0</span>';a+='</div>';$(gameCont).append(a);$(gameCont).show()}function loadGame(){clearBox();addGameField();onLoad()}function loadOneSnake(){snake2=false;loadGame()}function loadTwoSnakes(){snake2=new Snake("snake2_");loadGame()}